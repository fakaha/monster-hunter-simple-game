<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Game</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <div class="content">
        <div class="box">
            <img class="char" src="char-mount-side.png" alt="">

            <div class="button-box">
                <button id="up">↑</button>
                <div class="side-button">
                    <button id="left">←</button>
                    <button id="right">→</button>
                </div>
                <button id="bottom">↓</button>
                <button id="jump">Jump</button>
            </div>

            <div class="land"></div>
        </div>
    </div>

    <script>
        const char = document.querySelector('.char');
        const box = document.querySelector('.box');
        let positionX = 0;
        char.style.left = positionX + 'px'
        let positionY = 30;
        char.style.bottom = positionY + 'px';
        let isJumping = false;
        let facingRight = true;

        const upBtn = document.getElementById('up');
        const downBtn = document.getElementById('bottom');
        const leftBtn = document.getElementById('left');
        const rightBtn = document.getElementById('right');
        const jumpBtn = document.getElementById('jump');

        let flyOffset = 0; 
        let flyDirection = 1;
        
        const boxWidth = box.clientWidth;
        const charWidth = char.clientWidth;

        let isFire = false;
        let fireBall = null;
        
        function throttle(callback, delay) {
            let lastTime = 0;
            return function() {
                const now = Date.now();
                if(now - lastTime >= delay){
                    callback();
                    lastTime = now;
                }
            }
        }
               
        gravity();
        flyingAnimation();
        moveFireBall();

        function gravity () {
            if(positionY <= 30){
                isJumping = false
                char.src = "char-mount-side.png"
                char.style.transform = facingRight ? "scaleX(1)" : "scaleX(-1)";
            }
            
            if(isJumping){

                    if(positionY > 30){
                        positionY -= 5;
                        char.style.bottom = positionY + 'px';
                    }
                }
                
                requestAnimationFrame(gravity);
            }
            
            function jump(){
                if(isJumping) return;
                
                isJumping = true;
                positionY += 30;
                char.style.bottom  = positionY + 'px';
            }

            function flyingAnimation(){
                if(positionY > 30){
                    flyOffset += 0.5 * flyDirection;
                    if(flyOffset > 10 || flyOffset < -10){
                        flyDirection *= -1;
                    }
                    char.style.bottom = (positionY + flyOffset) + 'px';
                }else{
                    flyOffset = 0;
                }

                requestAnimationFrame(flyingAnimation);
            }

            function getFireBallPosition() {
                if(fireBall) {
                    return parseFloat(fireBall.style.left.replace("px",""));
                }
                return null;
            }

            function moveFireBall(){
                if(fireBall){
                    let pos = parseFloat(fireBall.style.left.replace("px", ""));
                    
                    pos += 15 * fireBall.direction;
                    
                    fireBall.style.left = pos + "px";

                    if(pos > box.clientWidth){
                        fireBall.remove();
                        fireBall = null;
                    }
                }

                requestAnimationFrame(moveFireBall);
            }

            function shootFireBall(){
                fireBall = document.createElement("img");
                fireBall.classList = 'fireball';
                fireBall.src = "fireball.png";
                fireBall.style.width = "auto";
                isFire = true;
                if(positionY > 30){
                    fireBall.style.bottom = (positionY + 85) + "px";
                }else{
                    fireBall.style.bottom = (positionY + 40) + "px";
                }

                if(facingRight){
                    fireBall.style.transform = "scaleX(-1)";
                    fireBall.style.left = (positionX + 130) + "px";
                    fireBall.direction = 1;
                }else{
                    fireBall.style.left = (positionX + 40) + "px";
                    fireBall.direction = -1;
                }
                fireBall.style.position = "absolute";
                fireBall.style.height = "40px";
                
                box.appendChild(fireBall);
                let fireBallPosition = parseFloat(fireBall.style.left.replace("px",""));
            }
            
            const throttleJump = throttle(jump, 300);
            const throttleFire = throttle(shootFireBall,  2500);
            
            document.addEventListener('keydown', function(event){
                
                if(event.key === "ArrowRight"){
                    facingRight = true;
                    if(positionX < boxWidth - (charWidth - 50)){
                        if(positionY > 30){
                            positionX += 40;
                            char.style.left = positionX +  'px';
                            char.style.transform = "scaleX(-1)"
                        }else if(positionY < 31){
                            positionX += 10;
                        char.style.left = positionX +  'px';
                        char.style.transform = "scaleX(1)"
                    }
                }
            }
            
            if(event.key === "ArrowLeft"){
                facingRight = false;
                if(positionX > -60){
                    if(positionY > 30){
                        positionX -= 40;
                        char.style.left = positionX + 'px';
                        char.style.transform = "scaleX(1)"
                    }else if(positionY < 31){
                        positionX -= 10;
                        char.style.left = positionX + 'px';
                        char.style.transform = "scaleX(-1)"
                    }
                }
            }
            
            if(event.key === "ArrowUp"){
                char.src = 'rath-fly.png';
                char.style.transform = facingRight ? "scaleX(-1)" : "scaleX(1)";
                positionY += 40;
                char.style.bottom = positionY + 'px';
            }
            
            if(event.key === "ArrowDown"){
                if(positionY > 30){
                    positionY -= 20;
                    char.style.bottom = positionY + 'px';
                }else{
                    char.src = "char-mount-side.png"
                    char.style.transform = facingRight ? "scaleX(1)" : "scaleX(-1)";
                }
                
            }
            
            if(event.key === " " || event.code === "Space"){
                event.preventDefault();
                throttleJump();
            }

            if(event.key === 'f'){
                event.preventDefault();
                throttleFire();
            }
        })
        
        upBtn.addEventListener('click', function(){
            char.src = 'rath-fly.png';
            char.style.transform = facingRight ? "scaleX(-1)" : "scaleX(1)";
            positionY += 40;
            char.style.bottom = positionY + 'px';
        })
        
        downBtn.addEventListener('click', function(){
            if(positionY > 30){
                positionY -= 20;
                char.style.bottom = positionY + 'px';
            }else{
                char.src = "char-mount-side.png"
                char.style.transform = facingRight ? "scaleX(1)" : "scaleX(-1)";
            }
        })
        
        leftBtn.addEventListener('click', function(){
            facingRight = false;
            if(positionX > -60){
                if(positionY > 30){
                    positionX -= 40;
                    char.style.left = positionX + 'px';
                    char.style.transform = "scaleX(1)"
                }else if(positionY < 31){
                    positionX -= 10;
                    char.style.left = positionX + 'px';
                    char.style.transform = "scaleX(-1)"
                }
            }
        })
        
        rightBtn.addEventListener('click', function(){
            facingRight = true;
            if(positionX < boxWidth - (charWidth - 50)){
                if(positionY > 30){
                    positionX += 40;
                    char.style.left = positionX +  'px';
                    char.style.transform = "scaleX(-1)"
                }else if(positionY < 31){
                    positionX += 10;
                    char.style.left = positionX +  'px';
                    char.style.transform = "scaleX(1)"
                }
            }
        })

        jumpBtn.addEventListener('click', function(){
            event.preventDefault();
            throttleJump();
        })
        </script>
</body>
</html>